(this["webpackJsonpreact-role-based-authorization-example"]=this["webpackJsonpreact-role-based-authorization-example"]||[]).push([[0],{1174:function(e,t){},1176:function(e,t){},1212:function(e,t){},1213:function(e,t){},1277:function(e,t){},1278:function(e,t){},1304:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=1304},1322:function(e,t){},1324:function(e,t){},1332:function(e,t,n){var r={"./buffer":456,"./buffer.js":456,"./console":457,"./console.js":457,"./dns":458,"./dns.js":458,"./empty":249,"./empty.js":249,"./net":459,"./net.js":459,"./process":460,"./process.js":460,"./punycode":461,"./punycode.js":461,"./tls":462,"./tls.js":462,"./tty":463,"./tty.js":463};function a(e){var t=s(e);return n(t)}function s(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=s,e.exports=a,a.id=1332},135:function(e,t,n){"use strict";(function(e){var r,a=n(136),s=n(562),o=n(6),i=(r={mode:"development",resolve:{extensions:[".js",".jsx"]},module:{rules:[{test:/\.jsx?$/,loader:"babel-loader"}]}},Object(a.a)(r,"resolve",{extensions:[".js",".jsx"],alias:{"@":o.resolve(e,"src/")}}),Object(a.a)(r,"plugins",[new s({template:"./public/index.html"})]),Object(a.a)(r,"devServer",{historyApiFallback:!0}),Object(a.a)(r,"externals",{config:JSON.stringify({apiUrl:"http://localhost:4000"})}),r);t.a=i}).call(this,"/")},1455:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=1455},1538:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=1538},1684:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),s=n(551),o=n(64),i=n(65),l=n(67),u=n(66),c=n(68),m=n(1691),d=n(1687),A=n(1689),p=n(1688),f=n(135),h=new p.a(JSON.parse(localStorage.getItem("currentUser"))),v={login:function(e,t){var n={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})};return fetch("".concat(f.a.apiUrl,"/users/authenticate"),n).then(j).then((function(e){return localStorage.setItem("currentUser",JSON.stringify(e)),h.next(e),e}))},logout:function(){localStorage.removeItem("currentUser"),h.next(null)},currentUser:h.asObservable(),get currentUserValue(){return h.value}};var g={getAll:function(){var e={method:"GET",headers:E()};return fetch("".concat(f.a.apiUrl,"/users"),e).then(j)},getById:function(e){var t={method:"GET",headers:E()};return fetch("".concat(f.a.apiUrl,"/users/").concat(e),t).then(j)}};function E(){var e=v.currentUserValue;return e&&e.token?{Authorization:"Bearer ".concat(e.token)}:{}}function j(e){return e.text().then((function(t){var n=t&&JSON.parse(t);if(!e.ok){-1===[401,403].indexOf(e.status)||v.logout();var r=n&&n.message||e.statusText;return Promise.reject(r)}return n}))}var b=n(69),N=Object(b.a)(),O={Admin:"Admin",User:"User"},w=n(555),y=n(1690),k=function(e){var t=e.component,n=e.roles,r=Object(w.a)(e,["component","roles"]);return a.a.createElement(A.a,Object.assign({},r,{render:function(e){var r=v.currentUserValue;return r?n&&-1===n.indexOf(r.role)?a.a.createElement(y.a,{to:{pathname:"/"}}):a.a.createElement(t,e):a.a.createElement(y.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},U=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={currentUser:v.currentUserValue,userFromApi:null},n}return Object(c.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.state.currentUser;g.getById(t.id).then((function(t){return e.setState({userFromApi:t})}))}},{key:"render",value:function(){var e=this.state,t=e.currentUser,n=e.userFromApi;return a.a.createElement("div",null,a.a.createElement("h1",null,"Home"),a.a.createElement("p",null,"You're logged in with React & JWT!!"),a.a.createElement("p",null,"Your role is: ",a.a.createElement("strong",null,t.role),"."),a.a.createElement("p",null,"This page can be accessed by all authenticated users."),a.a.createElement("div",null,"Current user from secure api end point:",n&&a.a.createElement("ul",null,a.a.createElement("li",null,n.firstName," ",n.lastName))))}}]),t}(a.a.Component),C=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={users:null},n}return Object(c.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this;g.getAll().then((function(t){return e.setState({users:t})}))}},{key:"render",value:function(){var e=this.state.users;return a.a.createElement("div",null,a.a.createElement("h1",null,"Admin"),a.a.createElement("p",null,"This page can only be accessed by administrators."),a.a.createElement("div",null,"All users from secure (admin only) api end point:",e&&a.a.createElement("ul",null,e.map((function(e){return a.a.createElement("li",{key:e.id},e.firstName," ",e.lastName)})))))}}]),t}(a.a.Component),T=n(83),x=n(186),D=function(e){function t(e){var n;return Object(o.a)(this,t),n=Object(l.a)(this,Object(u.a)(t).call(this,e)),v.currentUserValue&&n.props.history.push("/"),n}return Object(c.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return a.a.createElement("div",null,a.a.createElement("div",{className:"alert alert-info"},a.a.createElement("strong",null,"Normal User")," - U: user P: user",a.a.createElement("br",null),a.a.createElement("strong",null,"Administrator")," - U: admin P: admin"),a.a.createElement("h2",null,"Login"),a.a.createElement(T.d,{initialValues:{username:"",password:""},validationSchema:x.object().shape({username:x.string().required("Username is required"),password:x.string().required("Password is required")}),onSubmit:function(t,n){var r=t.username,a=t.password,s=n.setStatus,o=n.setSubmitting;s(),v.login(r,a).then((function(t){var n=(e.props.location.state||{from:{pathname:"/"}}).from;e.props.history.push(n)}),(function(e){o(!1),s(e)}))},render:function(e){var t=e.errors,n=e.status,r=e.touched,s=e.isSubmitting;return a.a.createElement(T.c,null,a.a.createElement("div",{className:"form-group"},a.a.createElement("label",{htmlFor:"username"},"Username"),a.a.createElement(T.b,{name:"username",type:"text",className:"form-control"+(t.username&&r.username?" is-invalid":"")}),a.a.createElement(T.a,{name:"username",component:"div",className:"invalid-feedback"})),a.a.createElement("div",{className:"form-group"},a.a.createElement("label",{htmlFor:"password"},"Password"),a.a.createElement(T.b,{name:"password",type:"password",className:"form-control"+(t.password&&r.password?" is-invalid":"")}),a.a.createElement(T.a,{name:"password",component:"div",className:"invalid-feedback"})),a.a.createElement("div",{className:"form-group"},a.a.createElement("button",{type:"submit",className:"btn btn-primary",disabled:s},"Login"),s&&a.a.createElement("img",{src:"data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="})),n&&a.a.createElement("div",{className:"alert alert-danger"},n))}}))}}]),t}(a.a.Component),M=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={currentUser:null,isAdmin:!1},n}return Object(c.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this;v.currentUser.subscribe((function(t){return e.setState({currentUser:t,isAdmin:t&&t.role===O.Admin})}))}},{key:"logout",value:function(){v.logout(),N.push("/login")}},{key:"render",value:function(){var e=this.state,t=e.currentUser,n=e.isAdmin;return a.a.createElement(m.a,{history:N},a.a.createElement("div",null,t&&a.a.createElement("nav",{className:"navbar navbar-expand navbar-dark bg-dark"},a.a.createElement("div",{className:"navbar-nav"},a.a.createElement(d.a,{to:"/",className:"nav-item nav-link"},"Home"),n&&a.a.createElement(d.a,{to:"/admin",className:"nav-item nav-link"},"Admin"),a.a.createElement("a",{onClick:this.logout,className:"nav-item nav-link"},"Logout"))),a.a.createElement("div",{className:"jumbotron"},a.a.createElement("div",{className:"container"},a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-6 offset-md-3"},a.a.createElement(k,{exact:!0,path:"/",component:U}),a.a.createElement(k,{path:"/admin",roles:[O.Admin],component:C}),a.a.createElement(A.a,{path:"/login",component:D})))))))}}]),t}(a.a.Component);!function(){var e=[{id:1,username:"admin",password:"admin",firstName:"Admin",lastName:"User",role:O.Admin},{id:2,username:"user",password:"user",firstName:"Normal",lastName:"User",role:O.User}],t=window.fetch;window.fetch=function(n,r){var a=r.headers.Authorization,s=a&&a.startsWith("Bearer fake-jwt-token"),o=s&&a.split(".")[1],i=o?O[o]:null;return new Promise((function(a,o){setTimeout((function(){if(n.endsWith("/users/authenticate")&&"POST"===r.method){var o=JSON.parse(r.body),l=e.find((function(e){return e.username===o.username&&e.password===o.password}));return l?A({id:l.id,username:l.username,firstName:l.firstName,lastName:l.lastName,role:l.role,token:"fake-jwt-token.".concat(l.role)}):(u="Username or password is incorrect",void a({status:400,text:function(){return Promise.resolve(JSON.stringify({message:u}))}}))}var u;if(n.match(/\/users\/\d+$/)&&"GET"===r.method){if(!s)return p();var c=n.split("/"),m=parseInt(c[c.length-1]),d=e.find((function(e){return e.role===i}));return m!==d.id&&i!==O.Admin?p():A(e.find((function(e){return e.id===m})))}if(n.endsWith("/users")&&"GET"===r.method)return i!==O.Admin?p():A(e);function A(e){a({ok:!0,text:function(){return Promise.resolve(JSON.stringify(e))}})}function p(){a({status:401,text:function(){return Promise.resolve(JSON.stringify({message:"Unauthorised"}))}})}t(n,r).then((function(e){return a(e)}))}),500)}))}}(),Object(s.render)(a.a.createElement(M,null),document.getElementById("app"))},227:function(e,t){},303:function(e,t,n){var r={"./NodeChunkTemplatePlugin":201,"./NodeChunkTemplatePlugin.js":201,"./NodeEnvironmentPlugin":304,"./NodeEnvironmentPlugin.js":304,"./NodeHotUpdateChunkTemplatePlugin":246,"./NodeHotUpdateChunkTemplatePlugin.js":246,"./NodeMainTemplate.runtime":200,"./NodeMainTemplate.runtime.js":200,"./NodeMainTemplateAsync.runtime":199,"./NodeMainTemplateAsync.runtime.js":199,"./NodeMainTemplatePlugin":194,"./NodeMainTemplatePlugin.js":194,"./NodeOutputFileSystem":245,"./NodeOutputFileSystem.js":245,"./NodeSourcePlugin":446,"./NodeSourcePlugin.js":446,"./NodeTargetPlugin":250,"./NodeTargetPlugin.js":250,"./NodeTemplatePlugin":193,"./NodeTemplatePlugin.js":193,"./NodeWatchFileSystem":202,"./NodeWatchFileSystem.js":202,"./ReadFileCompileWasmTemplatePlugin":464,"./ReadFileCompileWasmTemplatePlugin.js":464};function a(e){var t=s(e);return n(t)}function s(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=s,e.exports=a,a.id=303},365:function(e,t,n){var r={"./build":366,"./build.js":366,"./clean":367,"./clean.js":367,"./configure":219,"./configure.js":219,"./info":368,"./info.js":368,"./install":389,"./install.js":389,"./node-pre-gyp":212,"./node-pre-gyp.js":212,"./package":438,"./package.js":438,"./pre-binding":217,"./pre-binding.js":217,"./publish":439,"./publish.js":439,"./rebuild":440,"./rebuild.js":440,"./reinstall":441,"./reinstall.js":441,"./reveal":442,"./reveal.js":442,"./testbinary":244,"./testbinary.js":244,"./testpackage":443,"./testpackage.js":443,"./unpublish":444,"./unpublish.js":444,"./util/abi_crosswalk":218,"./util/abi_crosswalk.json":218,"./util/compile":151,"./util/compile.js":151,"./util/handle_gyp_opts":152,"./util/handle_gyp_opts.js":152,"./util/napi":26,"./util/napi.js":26,"./util/nw-pre-gyp/index.html":1302,"./util/nw-pre-gyp/package":445,"./util/nw-pre-gyp/package.json":445,"./util/s3_setup":112,"./util/s3_setup.js":112,"./util/versioning":37,"./util/versioning.js":37};function a(e){var t=s(e);return n(t)}function s(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=s,e.exports=a,a.id=365},557:function(e,t,n){e.exports=n(1684)},728:function(e,t){},730:function(e,t){},741:function(e,t){},743:function(e,t){},761:function(e,t){},763:function(e,t){},796:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=796},797:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=797}},[[557,1,2]]]);
//# sourceMappingURL=main.eec32d68.chunk.js.map